!function(e){let t=function a(){return{buildMapFilters:d,buildURL:function e(t,a,c){let l=o(),i="";if(a.asyncSearchTerm)i+=n.ORIGIN,i+=l;else{let s=new URL(c.url);i+=n.ORIGIN,i+=s.href.replace(s.origin,"")}return i+`?${n.ASYNC.LID_FILTER}&${d(--t)}`},getCategoryTree:c,getFilters:r,search:u};async function c(){return await e.get(`${n.ORIGIN}/api/catalog_system/pub/category/tree/${n.ASYNC.TREE_LEVEL}`)}async function r(a,c,l){return await e.get(t.buildURL(a,c,l))}function o(){return s.filter(e=>e.routeSelected).map(e=>e.routeSelected.includes("/")?e.routeSelected:`/${e.routeSelected}`).join("")}async function u(){var e,t;let a=s.filter(e=>e.routeSelected).length,c=o(),r=n.ORIGIN;if(0===i.length){alert("Selecione pelo menos o produto!");return}c&&(r+=c,r+=`?${d(a-1)}`),a<1&&(r=(e=i,(t=r)+(e.includes("/")?e:`/${e}`)+"?PS=20&map=c,c")),localStorage.setItem("smartSelectHistory",JSON.stringify({type:l,params:{plate:null,url:r}})),location.href=r}function d(e){let t="";for(let a=0;a<=e;a++)t+=n.ASYNC.MAP_PARAMS[a];return t}}(),a=function t(){return{_initSelect_:function t(c){e(`.c-busca__tab-content #${c.id}`).click(t=>{e(`.c-busca__tab-content #${c.id} .smart-select__main-results input`).val(""),c.values&&(a.buildList(c.values,c.id),a.selectOptionIfButtonHasValue(c.id),0!==c.values.length&&(e(`.c-busca__tab-content #${c.id} .smart-select__main-results`).slideToggle("fast").click(e=>e.stopPropagation()),e(`.c-busca__tab-content #${c.id} .smart-select__main-results input`).focus()))}),e(`.c-busca__tab-content #${c.id} .smart-select__main-results input`).on("keydown",t=>{if(("Tab"===t.key||"Enter"===t.key)&&(t.preventDefault(),e(`.c-busca__tab-content #${c.id} ul li.${n.CSS.HIGHLIGHT}`).click()),"ArrowDown"===t.key){let a=0;e(`.c-busca__tab-content #${c.id} ul li`).each((t,c)=>{c.classList.contains(n.CSS.HIGHLIGHT)&&(a+=t+2,e(c).removeClass(n.CSS.HIGHLIGHT))}),a<=e(`.c-busca__tab-content #${c.id} ul li`).length?(e(`.c-busca__tab-content #${c.id} ul li:nth-child(${a})`).addClass(n.CSS.HIGHLIGHT),e(`.c-busca__tab-content #${c.id} .smart-select__main-results ul`).animate({scrollTop:e(`.c-busca__tab-content #${c.id} ul li:nth-child(${a})`)[0].offsetTop-e(`.c-busca__tab-content #${c.id} ul li:nth-child(${a})`)[0].scrollHeight-e(`.c-busca__tab-content #${c.id} ul li:nth-child(${a})`)[0].scrollHeight/2},100)):(e(`.c-busca__tab-content #${c.id} ul li:nth-child(1)`).addClass(n.CSS.HIGHLIGHT),e(`.c-busca__tab-content #${c.id} .smart-select__main-results ul`).animate({scrollTop:e(`.c-busca__tab-content #${c.id} ul li:nth-child(1)`)[0].offsetTop-(e(`.c-busca__tab-content #${c.id} ul li:nth-child(1)`)[0].scrollHeight+e(`.c-busca__tab-content #${c.id} ul li:nth-child(1)`)[0].scrollHeight/2)},100))}if("ArrowUp"===t.key){let l=0;e(`.c-busca__tab-content #${c.id} ul li`).each((t,a)=>{a.classList.contains(n.CSS.HIGHLIGHT)&&(l=t,e(a).removeClass(n.CSS.HIGHLIGHT))}),0!==l?(e(`.c-busca__tab-content #${c.id} ul li:nth-child(${l})`).addClass(n.CSS.HIGHLIGHT),e(`.c-busca__tab-content #${c.id} .smart-select__main-results ul`).animate({scrollTop:e(`.c-busca__tab-content #${c.id} ul li:nth-child(${l})`)[0].offsetTop-(e(`.c-busca__tab-content #${c.id} ul li:nth-child(${l})`)[0].scrollHeight+e(`.c-busca__tab-content #${c.id} ul li:nth-child(${l})`)[0].scrollHeight/2)},100)):(e(`.c-busca__tab-content #${c.id} ul li:nth-child(${e(`.c-busca__tab-content #${c.id} ul li`).length})`).addClass(n.CSS.HIGHLIGHT),e(`.c-busca__tab-content #${c.id} .smart-select__main-results ul`).animate({scrollTop:e(`.c-busca__tab-content #${c.id} ul li:nth-child(${e(`.c-busca__tab-content #${c.id} ul li`).length})`)[0].offsetTop-(e(`.c-busca__tab-content #${c.id} ul li:nth-child(${e(`.c-busca__tab-content #${c.id} ul li`).length})`)[0].scrollHeight+e(`.c-busca__tab-content #${c.id} ul li:nth-child(${e(`.c-busca__tab-content #${c.id} ul li`).length})`)[0].scrollHeight/2)},100))}}).on("keyup",e=>{console.log("Filtrando"),["Tab","ArrowDown","ArrowUp","Enter"].find(t=>t===e.key)||a.filterResults(e,c)}),e(document).on("click",t=>{var a=e(`.c-busca__tab-content #${c.id}`);e(t.target).closest(a).length||e(`.c-busca__tab-content #${c.id} .smart-select__main-results`).slideUp("fast")})},buildList:i,selectOptionIfButtonHasValue:function t(a){e(`.c-busca__tab-content > .${a} ul li`).each((t,c)=>{c.innerHTML===e(`.c-busca__tab-content > .${a} div > span`).html()&&e(c).addClass(n.CSS.SELECTED)})},filterResults:function e(t,a){t.target.value?i(a.values.filter(e=>o(e.name.toUpperCase()).includes(o(t.target.value.toUpperCase()))),a.id):i(a.values,a.id)},resetResults:r,virtualizedDOM:function e(t,a){let c=document.createElement("div");return c.innerHTML=t,[...c.querySelectorAll(`${a} > li > a`)].map(e=>({id:e.href,name:e.innerHTML.replace(/\s\(\d+\)/,""),pathname:e.pathname,search:e.search}))},createNavigation:function t(a,c){let l=s.findIndex(e=>e.id===a),i=s[l],o=s[l+1];e(`.c-busca__tab-content  #${i.id} > div > span`).html(c),e(`.c-busca__tab-content  #${i.id} > div > .${n.CSS.ARROW_DOWN}`).hide(),e(`.c-busca__tab-content  #${i.id} > div > .${n.CSS.CLOSE}`).show().on("click",()=>r(l)),o?(e(`.c-busca__tab-content #${o.id}`).removeClass(n.CSS.EMPTY),n.CANT_OPEN||e(`.c-busca__tab-content #${o.id}`).click()):n.CANT_OPEN||e(`.c-busca__tab-content  #${i.id}`).click().focus()}};function i(t,a){let i="";t?(t.forEach(e=>i+=`<li role="treeitem" id="${e.id}">${e.name}</li>`),e(`.c-busca__tab-content  #${a} ul`).html(i),e(`.c-busca__tab-content  #${a} ul li`).hover(t=>{e(`.c-busca__tab-content  #${a} ul li`).removeClass(n.CSS.HIGHLIGHT),e(t.target).addClass(n.CSS.HIGHLIGHT)}).click(e=>{switch(l){case"#busca-peca":c.addClick(e,a);break;case"#busca-placa":h(e,a)}}),e(`.c-busca__tab-content  #${a} ul li`).first().addClass(n.CSS.HIGHLIGHT)):e(`.c-busca__tab-content  #${a} ul`).html('<li style="background: white; color:#707070; cursor: default">Nenhum resultado encontrado.</li>')}function r(t){for(let a=t;a<=s.length-1;a++){let c=s[a],l=s[a+1];e(`.c-busca__tab-content  #${c.id} > div > span`).html(c.title),c.routeSelected="",l&&l.canBeClear&&(e(`.c-busca__tab-content #${l.id}`).addClass(n.CSS.EMPTY),l.values=[],l.routeSelected=""),e(`.c-busca__tab-content  #${c.id} > div > .${n.CSS.ARROW_DOWN}`).show(),e(`.c-busca__tab-content  #${c.id} > div > .${n.CSS.CLOSE}`).hide()}}function o(e){return[{char:"A",base:/[\300-\306]/g},{char:"a",base:/[\340-\346]/g},{char:"E",base:/[\310-\313]/g},{char:"e",base:/[\350-\353]/g},{char:"I",base:/[\314-\317]/g},{char:"i",base:/[\354-\357]/g},{char:"O",base:/[\322-\330]/g},{char:"o",base:/[\362-\370]/g},{char:"U",base:/[\331-\334]/g},{char:"u",base:/[\371-\374]/g},{char:"N",base:/[\321]/g},{char:"n",base:/[\361]/g},{char:"C",base:/[\307]/g},{char:"c",base:/[\347]/g},].forEach(function(t){e=e.replace(t.base,t.char)}),e}}(),c=function e(){return{addClick:l,checkRouterParams:r};async function l(e,c){let l=s.findIndex(e=>e.id===c),n=s[l],r=s[l+1],o=n.values.find(t=>t.id==e.target.id),u=new p;if(u.mostarSpinner(),a.resetResults(l),0!==l?n.routeSelected=o.url?o.url.replace(new URL(o.url).origin,""):o.name:i=o.url?o.url.replace(new URL(o.url).origin,""):o.name,r){if(o&&n.isAsyncSearch){let d=await t.getFilters(l,n,o),h=a.virtualizedDOM(d,r.asyncSearchTerm);l+1===s.length-1?h.sort((e,t)=>t.name.localeCompare(e.name)):h.sort((e,t)=>e.name.localeCompare(t.name)),r.values=h}else r.values=o.children.sort((e,t)=>e.name.localeCompare(t.name));a.buildList(r.values,r.id)}a.createNavigation(n.id,e.target.innerHTML),u.ocultarSpinner()}async function r(){let{pathname:e,search:t}=location;if(t&&t.includes(n.ASYNC.MAP_PARAMS[0])||t.includes("?PS=20&map=c,c")){n.CANT_OPEN=!0;let a=decodeURI(e).split("/").filter(e=>e),{input:l,...i}=a.slice(0,3).join("/").match(/(\w+\/\w+)/),r=[i[0],l,...a.slice(3,a.length),];t.match(/\?PS=20&map=c,c$/)&&(r=[i[0]]);for(let o=0;o<r.length;o++){let u=s[o],d=u.values.find(e=>e.url?e.url.includes(r[o]):e.name.includes(r[o]));await c.addClick({target:{id:d.id,innerHTML:d.name}},u.id)}}n.CANT_OPEN=!1}}(),l="#busca-peca",i="",n={ASYNC:{MAP_PARAMS:["PS=20&map=c,c,c",",specificationFilter_36",",specificationFilter_50",",specificationFilter_48"],TREE_LEVEL:2,LID_FILTER:"lid=bf120500-baab-4185-8b70-cc630f7d1c70"},CSS:{HIGHLIGHT:"highlight",EMPTY:"empty",ARROW_DOWN:"fa-caret-down",CLOSE:"fa-close",SELECTED:"selected"},CANT_OPEN:!1,ORIGIN:"https://www.autoglassonline.com.br"},s=[{title:"Produto",id:"produtos-select",values:[],routeSelected:"",isAsyncSearch:!1,asyncSearchTerm:"",canBeClear:!1},{title:"Pe\xe7a",id:"pecas-select",values:[],routeSelected:"",isAsyncSearch:!0,asyncSearchTerm:"",canBeClear:!0},{title:"Montadora",id:"montadora-select",values:[],routeSelected:"",isAsyncSearch:!0,asyncSearchTerm:".Compatibilidade.Montadora",canBeClear:!0},{title:"Ve\xedculo",id:"veiculo-select",values:[],routeSelected:"",isAsyncSearch:!0,asyncSearchTerm:".Ve\xedculo",canBeClear:!0},{title:"Ano",id:"ano-select",values:[],routeSelected:"",isAsyncSearch:!0,asyncSearchTerm:".Ano",canBeClear:!0},];async function r(){var c;let l=await t.getCategoryTree(),i=[];l.filter(e=>e.hasChildren).forEach(e=>{i.push(...e.children)}),c=i,d[0].values=c,a.buildList(d[0].values,d[0].id),a._initSelect_(d[0]),function t(){let{pathname:a,search:c}=location,l=JSON.parse(localStorage.getItem("smartSelectHistory")),i=l&&"#busca-placa"==l.type;if(c&&c.includes("?PS=24&map=")){if(c.includes("c,c,")){let n=decodeURI(a).split("/").filter(e=>e).slice(0,2).join("/"),s=d[0],r=s.values.find(e=>e.url?e.url.includes(n):e.name.includes(n));h({target:{id:r.id,innerHTML:r.name}},s.id)}i&&(document.querySelector("a[href='#busca-placa']").click(),document.querySelector("#placa-input").value=l.params.plate)}if(i&&l.params.url){if(c||(c=""),a||(a=""),!c.includes("?PS=24&map=")&&!a.includes("buscavazia")){localStorage.removeItem("smartSelectHistory");return}let[o,u]=l.params.url.split("?"),b=o.split("/").filter(e=>e),p=u.includes("c,c,")?b.slice(2,b.length):b;3===p.length&&p.splice(1,1);let m=p.reverse().join(" "),S=e(".resultado-busca-termo");S.length&&(S.addClass("has-value"),S.find(".value").text(m));let f=e("#busca-ft span:empty");f.length&&f.text(m+".")}}(),document.querySelector("#form-busca-placa").addEventListener("submit",e=>{e.preventDefault();let[t,a]=function e(){let t=d[0];if(t.routeSelected.length){let a=t.routeSelected;if(["/lampadas","/filtros","/higienizadores"].some(e=>a.includes(e)))return[!0,`${a}?PS=20&map=c,c`];if(a.includes("/borrachas-e-outros/borracha"))return[!0,"/borrachas-e-outros/borracha/borracha-universal-parabrisa?PS=20&map=c,c,c",]}return[!1,""]}();if(t)(new p).mostarSpinner(),location.href=a;else{let c=document.querySelector("#placa-input").value;0===c.length?alert("Voc\xea deve inserir a placa do seu ve\xedculo!"):c.trim().match(/^[A-Z]{3}[\-_]?[0-9][0-9A-Z][0-9]{2}$/i)?b(c):alert("Sua placa n\xe3o segue um padr\xe3o v\xe1lido!")}}),await o(i)}async function o(l){s[0].values=l,console.log(s),await c.checkRouterParams(),a.buildList(s[0].values,s[0].id),s.forEach(a._initSelect_),e("#form-busca-peca").submit(e=>{e.preventDefault(),t.search()})}r(),window.onload=()=>{if(window.matchMedia("(max-width: 1100px)").matches){var t=e(".system-error-qd-v1");(t.length||(t=e(".search-qd-v1-result")).length)&&(pixelsToScroll=(aimElementTopOffset=t.offset().top)-(offsets=e("header.nav").height()+e("div.topo").height()),e("html, body").animate({scrollTop:pixelsToScroll},"slow"))}};let u=document.querySelectorAll(".c-busca__tabs li");u.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),u.forEach(e=>e.classList.remove("is-active")),e.classList.add("is-active"),l=e.querySelector("a").attributes.href.nodeValue,document.querySelectorAll(".c-busca__tab-content").forEach(e=>e.classList.remove("is-active")),document.querySelector(e.querySelector("a").hash).classList.add("is-active")})});let d=[{title:"Produto",id:"categoria-select",values:[],routeSelected:"",isAsyncSearch:!1,asyncSearchTerm:"",canBeClear:!1},];function h(t,a){let c=d[0],l=c.values.find(e=>e.id==t.target.id);c.routeSelected=l.url?l.url.replace(new URL(l.url).origin,""):"/"+l.name.toLowerCase(),e(`.c-busca__tab-content  #${c.id} > div > span`).html(t.target.innerHTML),e(`.c-busca__tab-content  #${c.id} > div > .${n.CSS.ARROW_DOWN}`).hide(),e(`.c-busca__tab-content  #${c.id} > div > .${n.CSS.CLOSE}`).show().on("click",()=>{e(`.c-busca__tab-content  #${c.id} > div > span`).html(c.title),c.routeSelected="",e(`.c-busca__tab-content  #${c.id} > div > .${n.CSS.ARROW_DOWN}`).show(),e(`.c-busca__tab-content  #${c.id} > div > .${n.CSS.CLOSE}`).hide()}),e(".c-busca__tab-content .c-busca__input #placa-input").click().focus()}async function b(e){var t,a,c,i,s;let r=d[0],o={MONTADORA:36,VEICULO:50,ANO:48},u=new p,h=(t=e).trim().replace(/[\W_]+/g,"").toUpperCase();try{u.mostarSpinner();let[b,m,S]=await (await fetch(`https://crawler-keplaca.herokuapp.com/placa/${h}`)).json();if(null===b&&null===m&&null===S)throw new M(h);console.table({Montadora:b,Modelo:m,Ano:S});let f=await (await fetch(`${n.ORIGIN}/api/catalog_system/pub/specification/fieldValue/${o.MONTADORA}`)).json(),g=(a=b,RegExp(a.split(" ").join("|"),"gi")),$=f.filter(e=>g.test(e.Value));console.log($);let v,C,y,H,T,A,I,L=await (await fetch(`${n.ORIGIN}/api/catalog_system/pub/specification/fieldValue/${o.VEICULO}`)).json(),w=(i=b,s=m,v=i.split(" ").filter(e=>RegExp(/[^\W_]+/,"gi").test(e)),"VOLKSWAGEN"===v[0].toUpperCase()&&v.push("VW"),"GM"===v[0].toUpperCase()&&v.push("CHEV"),C=s.replace(RegExp(v.join("|"),"gi"),"").trim().split(" "),y=["NOVA","NOVO"].some(e=>C.find(t=>t.toUpperCase()===e))?C[1]:C[0],"PAJERO"===C[0].toUpperCase()&&C[1]&&(y=C[0]+" "+C[1]),H=y.replace(/[\W]+/gi,""),T=`(${v.join("|")})`,A=y===H?y:`(${y}|${H})`,I=`${"STRADA"===H.toUpperCase()?"^":""}${A}$|${T} ${A}$`,console.log(I),RegExp(I,"gi")),O=L.filter(e=>w.test(e.Value));console.log(O);let E=await (await fetch(`${n.ORIGIN}/api/catalog_system/pub/specification/fieldValue/${o.ANO}`)).json(),_=(c=S,RegExp(c.trim(),"gi")),N=E.filter(e=>_.test(e.Value));console.log(N);let R="",G="?PS=24&map=";if(!N.length&&!$.length&&!O.length)throw new M(h);if(r.routeSelected.length&&(R+=r.routeSelected,G+="c,c,"),N.length&&(R+=`/${N[0].Value}`,G+=`specificationFilter_${o.ANO},`),$.length){let P=$[0].Value;P="Gm"===P?"Chevrolet":P,R+=`/${P}`,G+=`specificationFilter_${o.MONTADORA},`}O.length&&(R+=`/${O[0].Value}`,G+=`specificationFilter_${o.VEICULO}`),R+=G,localStorage.setItem("smartSelectHistory",JSON.stringify({type:l,params:{plate:h,url:R}})),console.log(R)}catch(k){k instanceof M?alert("Desculpe, n\xe3o conseguimos encontrar o seu ve\xedculo, favor utilizar a busca por pe\xe7a ou digitar seu carro e produto na busca livre no topo do site."):(alert("Perd\xe3o pelo inconveniente! O servi\xe7o de busca por placa est\xe1 fora do ar no momento. Favor utilizar a busca por pe\xe7a!"),console.error(k)),u.ocultarSpinner(),document.querySelector("a[href='#busca-peca']").click()}function M(e){this.value=e,this.message=" n\xe3o retornou resultados.",this.toString=function(){return this.value+this.message}}}class p{constructor(){let e=document.querySelectorAll(".smart-select__main-results"),t=document.querySelector(".c-busca .smart-select__modal");this.elementos=[...e,t]}mostarSpinner(){this.elementos.forEach(e=>e.classList.add("loader-modal--show"))}ocultarSpinner(){this.elementos.forEach(e=>e.classList.remove("loader-modal--show"))}}}(jQueryNew);