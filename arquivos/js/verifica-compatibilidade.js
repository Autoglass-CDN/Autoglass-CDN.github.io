window.addEventListener("load",()=>{function e(){let e=document.querySelectorAll(".pages li.page-number");e.forEach(e=>{e.setAttribute("href",`?${e.textContent.trim()}`)}),console.log("Atributo href atualizado nos elementos de pagina\xe7\xe3o.")}function o(){let o=document.querySelector(".pager.bottom");if(o){let t=new MutationObserver(o=>{o.forEach(o=>{"childList"===o.type&&e()})});t.observe(o,{childList:!0,subtree:!0}),e()}else console.log("Container de pagina\xe7\xe3o n\xe3o encontrado.")}o();let t=!1,a=document.querySelector(".compat-header");function i(){let e=document.getElementById("compatContent"),o=document.querySelector(".icon-arrow-down"),i=document.querySelector(".icon-arrow-up");(t=!t)?(e.style.display="block",o.style.display="none",i.style.display="block"):(e.style.display="none",a.style.paddingBottom="",o.style.display="block",i.style.display="none")}a.addEventListener("click",i)});const FILTROS_VTEX={MONTADORA:36,VEICULO:50,ANO:48,FIPE:76},CONFIG={ORIGIN:"https://autoglassonline.com.br",ASYNC:{TREE_LEVEL:2}},regexPlaca=/^[A-Z]{3}[\-_]?[0-9][0-9A-Z][0-9]{2}$/i,questionIcon=document.getElementById("icon-question"),tooltip=document.getElementById("tooltip-question"),botaoProdutosCompativeis=document.querySelector("#botaoProdutosCompativeis");function verificaPlacaValida(e){return!!(""!==e&&e.trim().match(regexPlaca))||(EstilizarCardCompatibilidade(),!1)}function montarUrlComFiltros(e,o=[]){let t="",a=[];if(e){e.startsWith("/")||(e="/"+e),e.endsWith("/")&&(e=e.slice(0,-1));let i=e.split("/").filter(Boolean);t+="/"+i.map(encodeURIComponent).join("/"),a.push(...i.map(()=>"c"))}o.forEach(e=>{e?.value&&e?.codigo&&(t+=`/${encodeURIComponent(e.value)}`,a.push(`specificationFilter_${e.codigo}`))});let r=a.join(",");return`${t}?PS=24&map=${r}`}async function tratarCompatibilidadeProduto(e,o,t=""){if(!verificaPlacaValida(e))return;let a=document.getElementById("overlayCompat");a.classList.remove("hidden");try{let i=e.trim().replace(/[\W_]+/g,"").toUpperCase(),{montadora:r,modelo:l,anoModelo:c,fipe:s}=await obterDadosDoVeiculoViaOlhoNoCarro(i),[n,d,u,p]=await Promise.all([encontrarDadosNoCadastroVtex({filtro:FILTROS_VTEX.MONTADORA,regex:obterRegexMontadoras(r)}),encontrarDadosNoCadastroVtex({filtro:FILTROS_VTEX.VEICULO,regex:obterRegexModelos(r,l)}),encontrarDadosNoCadastroVtex({filtro:FILTROS_VTEX.ANO,regex:obterRegexAnos(c)}),s?encontrarDadosNoCadastroVtex({filtro:FILTROS_VTEX.FIPE,regex:obterRegexFipes(s)}):[],]),m=[{value:p[0]?.Value,codigo:FILTROS_VTEX.FIPE},{value:u[0]?.Value,codigo:FILTROS_VTEX.ANO},{value:d[0]?.Value,codigo:FILTROS_VTEX.VEICULO},{value:n[0]?.Value,codigo:FILTROS_VTEX.MONTADORA},],C=montarUrlComFiltros("",m);if("verificarCompatibilidade"===o){let y=await buscarTodosProdutosCompatíveis(C),f=skuJson?.productId||window.vtex?.product?.id,b=y.some(e=>e.productId==f);EstilizarCardCompatibilidade(b,b?"sucesso":"erro")}else if("produtoCompativel"===o){let g=t?.trim()||"";g&&!g.startsWith("/")&&(g="/"+g),g.endsWith("/")&&(g=g.slice(0,-1));let E=montarUrlComFiltros(g,m);window.location.href=E}}catch(v){console.error("Erro ao tratar compatibilidade:",v),v.message?.includes("Placa n\xe3o encontrada")?EstilizarCardCompatibilidade():alert("Erro ao verificar compatibilidade. Tente novamente.")}finally{a.classList.add("hidden")}}function EstilizarCardCompatibilidade(e,o){resetarEstilosCompatibilidade(),e&&"sucesso"===o?aplicarEstadoCompatibilidade(estadoCompatSucesso()):e||"erro"!==o?aplicarEstadoCompatibilidade(estadoCompatDesconhecido()):aplicarEstadoCompatibilidade(estadoCompatErro())}function resetarEstilosCompatibilidade(){document.querySelector("#icon-verificar-compatibilidade-check").style.display="none",document.querySelector("#icon-verificar-compatibilidade-xmark").style.display="none",document.querySelector("#icon-question").style.display="none";let e=document.querySelector("#botaoVerificarCompatibilidade");e.textContent="Nova Consulta"}function aplicarEstadoCompatibilidade(e){let o=document.querySelector(".title-text"),t=document.querySelector(".compat-description"),a=document.querySelector(".compat-box"),i=document.querySelector("#placaInput");if(o.textContent=e.titulo,o.style.color=e.cor,t.textContent=e.descricao,a.style.borderColor=e.cor,i.style.borderColor=e.cor,e.icones.includes("check")){let r=document.querySelector("#icon-verificar-compatibilidade-check");r.style.display="block",r.style.color=e.cor}e.icones.includes("xmark")&&(document.querySelector("#icon-verificar-compatibilidade-xmark").style.display="block",botaoProdutosCompativeis.style.display="block"),e.icones.includes("question")&&(document.querySelector("#icon-question").style.display="block",botaoProdutosCompativeis.style.display="none")}function estadoCompatSucesso(){return{titulo:"Produto compat\xedvel com seu ve\xedculo",cor:"#44C15D",descricao:"Se desejar, voc\xea pode verificar outra placa clicando em nova consulta.",icones:["check"]}}function estadoCompatErro(){return{titulo:"Produto incompat\xedvel com seu ve\xedculo",cor:"#d93025",descricao:"Voc\xea pode realizar uma nova busca ou verificar outra placa clicando em nova consulta.",icones:["xmark"]}}function estadoCompatDesconhecido(){return{titulo:"N\xe3o sabemos se \xe9 compat\xedvel",cor:"#C89C00",descricao:"Por favor, verifique a lista de ve\xedculos compat\xedveis para esse produto ou voc\xea pode realizar uma nova consulta.",icones:["check","question"]}}async function obterDadosDoVeiculoViaOlhoNoCarro(e){let o=window.location.href.includes("hml")?"https://api-hml.autoglass.com.br":"https://api.autoglass.com.br",t=await fetch(`${o}/integracao-b2c/api/web-app/veiculos/${e}/placas`),a=await t.json();if(a?.Message?.includes("Placa \xe9 obrigat\xf3rio"))throw EstilizarCardCompatibilidade(),Error("Placa n\xe3o encontrada");let i=a.Body.Data.Marca,r=a.Body.Data.Modelo,l=a.Body.Data.DadosBasicosDoVeiculo.AnoModelo,c=a.Body.Data.DadosBasicosDoVeiculo.InformacoesFipe[0]?.FipeId,s=[{montadora:i,modelo:r,anoModelo:l,fipe:c,timestamp:new Date().toLocaleString()}];return localStorage.setItem("infoBuscaPLaca",JSON.stringify(s)),{montadora:i,modelo:r,anoModelo:l,fipe:c}}async function encontrarDadosNoCadastroVtex({filtro:e,regex:o}){let t=await fetch(`${CONFIG.ORIGIN}/api/catalog_system/pub/specification/fieldValue/${e}`),a=await t.json(),i=a.filter(e=>o.test(e.Value));return i}function obterRegexMontadoras(e){return RegExp(e.split(" ").join("|"),"gi")}function obterRegexModelos(e,o){let t=e.split(" ").filter(e=>RegExp(/[^\W_]+/,"gi").test(e)),a=mapeiaModeloParaNomenclaturaVtex(o,t),i=a.replace(/[\W]+/gi,""),r=`(${t.join("|")})`,l=`(${a}|${i})`,c=`^${l}$|${r} ${l}$`;return RegExp(c,"gi")}function obterRegexAnos(e){return RegExp(e.trim(),"gi")}function obterRegexFipes(e){let o=e.replace(/(\d+)(\d)$/,"0$1-$2");return RegExp(o,"i")}function mapeiaModeloParaNomenclaturaVtex(e,o){switch(!0){case"NEW CLASSIC"===e:return"CLASSIC";case"UP"===e:case"CROSS UP!"===e:return"Up!";case"FH 520"===e:return"FH 520";case RegExp(/^FH (12 )?\d{3}$/i).test(e):return"FH 12 Globetroter";case RegExp(/^FH 16 \d{3}$/i).test(e):return"FH 16 Globetroter";case RegExp(/^NH 12 \d{3}$/i).test(e):return"NH 12";case RegExp(/^NH 10 \d{3}$/i).test(e):return"NH 10";case"XC70"===e:return"S40";case"E-DELIVERY"===e:return"DELIVERY";case"POLO CLASSIC"===e:return"Polo Sedan";case"SS10"===e:return"S10";case"TTS"===e:return"TT";case RegExp(/^[A-Z]-CLASS$/i).test(e):return"Classe "+e.replace(/-CLASS/gi,"");default:let t=e.replace(RegExp(o.join(" "),"gi"),"").trim();return t}}async function buscarTodosProdutosCompatíveis(e){let o=[],t=0;for(;;){let a=t+50-1,i=await fetch(`/api/catalog_system/pub/products/search${e}&_from=${t}&_to=${a}`),r=await i.json();if(o.push(...r),r.length<50||(t+=50)>1e3)break}return o}async function getArvoreCategoria(){return await $.get(`${CONFIG.ORIGIN}/api/catalog_system/pub/category/tree/${CONFIG.ASYNC.TREE_LEVEL}`)}window.addEventListener("DOMContentLoaded",function(){let e=document.querySelector("#botaoVerificarCompatibilidade");e&&e.addEventListener("click",function(){tratarCompatibilidadeProduto(document.getElementById("placaInput").value,"verificarCompatibilidade")})}),questionIcon.addEventListener("mouseenter",()=>{tooltip.classList.remove("hidden")}),questionIcon.addEventListener("mouseleave",()=>{tooltip.classList.add("hidden")}),botaoProdutosCompativeis.addEventListener("click",async()=>{let e="",o=await getArvoreCategoria(),t=[],a=[];o.filter(e=>e.hasChildren).forEach(e=>{t.push(...e.children)}),t.forEach(e=>{a.push(...e.children)});let i=a.find(e=>e.id===window.dataLayer[0].productCategoryId);e=i.url?i.url.replace(new URL(i.url).origin,""):"/"+i.name.toLowerCase(),tratarCompatibilidadeProduto(document.getElementById("placaInput").value,"produtoCompativel",e)});