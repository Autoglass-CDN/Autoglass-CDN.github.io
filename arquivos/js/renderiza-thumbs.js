document.addEventListener("DOMContentLoaded",async()=>{let e=extrairRefIdDoNome(skuJson?.name),t=skuJson?.skus?.[0]?.sku;if(!e||!t){console.warn("RefId ou SKU ID ausente.");return}let[i,a]=await Promise.all([buscarImagensDoSku(t),buscarVideosDoSku(e)]);renderGaleria([...i,...a]);let o=document.getElementById("modalZoom");document.querySelector(".close-zoom").addEventListener("click",()=>o.style.display="none"),o.addEventListener("click",e=>{"modalZoom"===e.target.id&&(o.style.display="none")})});const urlApi=(window.location.href.includes("hml")||window.location.href.includes("dev"),"https://api.autoglass.com.br");function extrairRefIdDoNome(e){if(!e)return null;let t=e.split("-").pop().trim();return/^\d+$/.test(t)?t:null}async function buscarImagensDoSku(e){let t=`${urlApi}/integracao-b2c/api/web-app/sincronismo/sku/imagens/${e}`;try{let i=await (await fetch(t)).json();return Array.isArray(i)?i.map(e=>e.Url??(e.FileLocation?`https://autoglass.vteximg.com.br/${e.FileLocation.replace(/^.*?arquivos/,"arquivos")}`:null)).filter(Boolean):[]}catch(a){return console.error("Erro ao buscar imagens:",a),[]}}async function buscarVideosDoSku(e){let t=`${urlApi}/integracao-b2c/api/web-app/sincronismo/sku/${e}`;try{let i=await (await fetch(t)).json();return i.videoList||i.Videos||[]}catch(a){return console.error("Erro ao buscar v\xeddeos:",a),[]}}function renderGaleria(e){let t=document.getElementById("thumbsContainer"),i=document.getElementById("mainMediaContainer");t&&i&&(t.innerHTML=i.innerHTML="",e.forEach((e,i)=>{let a=/youtube|\.mp4$|\.webm$/i.test(e),o=document.createElement("li");o.className="thumb-item",o.innerHTML=a?`<div class="thumb-video"><video src="${e}" muted playsinline preload="metadata"></video></div>`:`<img src="${e}" alt="Miniatura ${i+1}" loading="lazy">`;let n=window.matchMedia("(min-width: 768px)").matches?"mouseenter":"click";o.addEventListener(n,()=>{document.querySelectorAll(".thumb-item").forEach(e=>e.classList.remove("active")),o.classList.add("active"),exibirMidia(e)}),t.appendChild(o),0===i&&(o.classList.add("active"),exibirMidia(e))}))}function exibirMidia(e){let t=document.getElementById("mainMediaContainer"),i=/youtube|\.mp4$|\.webm$/i.test(e),a=window.matchMedia("(min-width: 1024px)").matches;if(i){t.innerHTML=e.includes("youtube")?`<iframe src="${e.replace("watch?v=","embed/")}" frameborder="0" allowfullscreen></iframe>`:`<video src="${e}" controls autoplay></video>`;return}if(a){t.innerHTML=`<div class="zoom-wrapper" data-zoom-image="${e}" style="background-image:url('${e}')"></div>`;let o=t.querySelector(".zoom-wrapper");inicializarZoom(o),o.addEventListener("click",()=>{let t=document.getElementById("modalZoom"),i=document.getElementById("zoomedImage");i.src=e,t.style.display="block",inicializarZoomModal(i)})}else{t.innerHTML=`<img src="${e}" alt="Imagem Principal" id="mobileZoomTrigger" style="max-width:100%; height:auto;" />`;let n=document.getElementById("mobileZoomTrigger");n&&n.addEventListener("click",()=>{let t=document.getElementById("modalZoom"),i=document.getElementById("zoomedImage");i.src=e,t.style.display="block",inicializarZoomModal(i)})}}function inicializarZoom(e){let t=window.matchMedia("(min-width: 1024px)").matches;e&&t&&(e.style.backgroundSize="100%",e.style.backgroundPosition="center",e.addEventListener("mouseenter",()=>{e.style.backgroundSize="150%"}),e.addEventListener("mousemove",t=>{let i=e.getBoundingClientRect(),a=(t.clientX-i.left)/i.width*100,o=(t.clientY-i.top)/i.height*100;e.style.backgroundPosition=`${a}% ${o}%`}),e.addEventListener("mouseleave",()=>{e.style.backgroundSize="100%",e.style.backgroundPosition="center"}),e.addEventListener("click",()=>{let t=document.getElementById("modalZoom"),i=document.getElementById("zoomedImage");i.src=e.dataset.zoomImage,t.style.display="block"}))}function inicializarZoomModal(e){let t=!1;e.addEventListener("mouseenter",()=>{e.classList.add("zoomed"),t=!0}),e.addEventListener("mousemove",i=>{if(!t)return;let a=e.getBoundingClientRect(),o=(i.clientX-a.left)/a.width*100,n=(i.clientY-a.top)/a.height*100;e.style.transformOrigin=`${o}% ${n}%`}),e.addEventListener("mouseleave",()=>{e.classList.remove("zoomed"),e.style.transformOrigin="center center",t=!1})}