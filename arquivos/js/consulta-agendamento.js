var codCidades={SE:{code:"8529",nome:"Sergipe"},TO:{code:"9654",nome:"Tocantins"},BA:{code:"981",nome:"Bahia"},ES:{code:"1974",nome:"Esp\xedrito Santo"},DF:{code:"1730",nome:"Distrito Federal"},RS:{code:"7778",nome:"Rio Grande do Sul"},RJ:{code:"6808",nome:"Rio de Janeiro"},MT:{code:"4282",nome:"Mato Grosso"},PR:{code:"5916",nome:"Paran\xe1"},MS:{code:"4079",nome:"Mato Grosso do Sul"},GO:{code:"2015",nome:"Goi\xe1s"},AL:{code:"107",nome:"Alagoas"},CE:{code:"1320",nome:"Cear\xe1"},PA:{code:"4499",nome:"Par\xe1"},RN:{code:"7040",nome:"Rio Grande do Norte"},SC:{code:"8269",nome:"Santa Catarina"},MA:{code:"2533",nome:"Maranh\xe3o"},PI:{code:"5647",nome:"Piau\xed"},MG:{code:"3631",nome:"Minas Gerais"},PB:{code:"4823",nome:"Para\xedba"},AM:{code:"240",nome:"Amazonas"},PE:{code:"5229",nome:"Pernambuco"},SP:{code:"9423",nome:"S\xe3o Paulo"}};async function getDeliveriesEstimates(i,j,b){let k=location.href.includes("orderPlaced"),l=location.href.includes("checkout"),d=b&&b.length,e=a=>a.map(a=>({quantity:a.quantity,seller:a.seller,id:a.id})),a=[];try{if(k&&d){let m=await $.get(`/api/checkout/pub/orders/${$("#order-id").text().trim()}`);a=e(m.items)}else if(l&&d)a=e(b);else{let f=await vtexjs.catalog.getProductWithVariations(12685),g=await vtexjs.catalog.getCurrentProductWithVariations();a=[{quantity:1,seller:g.skus[0].sellerId,id:g.skus[0].sku},{quantity:1,seller:f.skus[0].sellerId,id:f.skus[0].sku},]}let n=readCookie("VTEXSC").replace("sc=",""),{logisticsInfo:c}=await $.ajax({type:"POST",url:`/api/checkout/pub/orderForms/simulation?sc=${n}`,dataType:"json",contentType:"application/json",data:JSON.stringify({country:"BRA",items:a,postalCode:i})}),h=c&&c.length?c[0]:j[0];if(h){let o=h.slas.map(a=>{let b=a.shippingEstimate,c=+b.replace("bd",""),d=new Date,e=addBusinessDays(d,c);return{Data:e,Nome:a.id,Tipo:a.deliveryChannel,DadosPickupPoint:a.pickupStoreInfo,Distancia:a.pickupDistance}});return o}}catch(p){return console.error("Falha ao calcular o tempo de entrega!",p),new Date}}function addBusinessDays(a,b){for(a=skipWeekends(a);b;)a=getNextBusinessDay(a),b--;return new Date(a)}function getNextBusinessDay(a){return a=addDay(a,1),a=skipWeekends(a)}function skipWeekends(a){for(;isWeekend(a);)a=addDay(a,1);return a}function isWeekend(b){let a=b.getDay();return 6==a||0==a}function addDay(a,b){return new Date(a.setDate(a.getDate()+b))}function readCookie(e){for(var c=e+"=",d=document.cookie.split(";"),b=0;b<d.length;b++){for(var a=d[b];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(c))return a.substring(c.length,a.length)}return console.error("N\xe3o foi poss\xedvel recuprar cookie VTEXSC'\n"),null}$(function(){let i=window.location.href.includes("dev")?"https://api-hml.autoglass.com.br/integracao-b2c/api/web-app/agendamentos":"https://api.autoglass.com.br/integracao-b2c/api/web-app/agendamentos",d=codCidades[$.cookie("myuf")],e=null;if(null!=d&&(e=d.code),window.location.href.includes("checkout")){if(window.location.search.includes("og=")){let f=window.location.search.split("=")[1];vtexjs.checkout.getOrders(f).then(a=>{j(a[0])})}$(window).on("orderFormUpdated.vtex",async(_,a)=>{await j(a)})}let b=new Date;b.setDate(b.getDate()+2),$(".secao-agendamento > .filter > .data input").datepicker({dateFormat:"dd/mm/yy",dayNames:["Domingo","Segunda","Ter\xe7a","Quarta","Quinta","Sexta","S\xe1bado","Domingo",],dayNamesMin:["D","S","T","Q","Q","S","S","D"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","S\xe1b","Dom"],monthNames:["Janeiro","Fevereiro","Mar\xe7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro",],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez",],minDate:b,beforeShowDay:a=>[!a.toDateString().includes("Sun")],async onSelect(){let a=vtexjs.checkout.orderForm,b=await getDeliveriesEstimates(a.shippingData.address.postalCode,a.shippingData.logisticsInfo,a.items);l(b)}}),$(".secao-agendamento > .filter > .data input").datepicker("setDate",b),$("#btn-alterar-local-instalacao").click(function(){$(".mz-install__close--button").click(),$("#btn-alterar-open-modal").click()});let a=JSON.parse(localStorage.getItem("AG_AddressSelected"));if(a){let g=window.location.href.includes("/checkout"),h=+localStorage.getItem("ufDefinedByTop");if(!g&&h)$(".secao-agendamento > .store-list > ul").html(`
        <div>
          <p>Por favor, informe um CEP para visualizar as lojas mais pr\xf3ximas</p>
        </div>
      `);else{let c;"undefined"!=typeof vtexjs&&vtexjs.checkout&&vtexjs.checkout.orderForm&&vtexjs.checkout.orderForm.items&&(c=vtexjs.checkout.orderForm.items),c?getDeliveriesEstimates(a.postalCode,a.logisticsInfo,c).then(a=>{k(a),l(a)}):vtexjs.checkout.getOrderForm().then(a=>{c=a.items}).then(getDeliveriesEstimates(a.postalCode,a.logisticsInfo,c).then(a=>{k(a),l(a)}))}}else $(window).on("cep-finish-load",async c=>{let a=c.originalEvent.detail,b=await getDeliveriesEstimates(a.shippingData.address.postalCode,a.shippingData.logisticsInfo,a.items);k(b),l(b)});async function j(a){if(a.shippingData.address&&a.shippingData.address.state){e=(d=codCidades[a.shippingData.address.state]).code||null,$(".store").remove();let b=await getDeliveriesEstimates(a.shippingData.address.postalCode,a.shippingData.logisticsInfo,a.items);k(b),l(b)}}function k(a){let c;c=a&&a.length?a[0].Data:b,$(".secao-agendamento > .filter > .data input").datepicker("option","minDate",c),$(".secao-agendamento > .filter > .data input").datepicker("refresh"),$(".secao-agendamento > .filter > .data input").datepicker("setDate",c)}function l(a){$.ajax({method:"GET",url:`${i}/horarios-lojas?Data=${$(".secao-agendamento .data input").datepicker("getDate").toISOString().split("T")[0]}&CodigoServico=17&CodigoCidade=${e}&Qt=30&Pg=1`}).done(function(c){if(m(),0==(pickupPoints=a.filter(a=>"pickup-in-point"===a.Tipo).map(a=>(a.store=c.Registros.reduce((b,c)=>(c.Nome.indexOf(a.DadosPickupPoint.address.addressId)> -1&&(b=c),b),null),a))).length){$(".secao-agendamento > .store-list > ul").append(r());return}$(".secao-agendamento .qtd").text(`Lojas pr\xf3ximas: ${pickupPoints.length}`);let b=[];horariosDisponiveisGeral=!1,pickupPoints.forEach(function(c){let a=o(c);b=a?b.concat(a):b}),horariosDisponiveisGeral?($(".secao-agendamento > .store-list > ul").append(b.join("\n")),$(".secao-agendamento > .store-list > ul").append(`
            <div class="mz-install__info">
              <div class="mz-info__list">
                <ul>
                  <li>
                    Ap\xf3s aprova\xe7\xe3o do pagamento, nossos analistas entrar\xe3o
                    em contato com voc\xea para confirmar o hor\xe1rio de agendamento.
                  </li>
                  <li>
                    Ser\xe1 realizada uma an\xe1lise pelo t\xe9cnico e caso
                    haja necessidade de troca de borrachas ou sensores,
                    o valor ser\xe1 cobrado na loja.
                  </li>
                </ul>
              </div>
            </div>
            `)):$(".secao-agendamento > .store-list > ul").append(q()),$(".timestamp").click(function(e){window.location.href.includes("checkout")&&$("body").removeClass("mz-bo-on mz-as-on mz-il-on"),$(".mz-install__button--buy").click(a=>a.preventDefault());let a=$(this).attr("data-store"),b=a.split(" ")[2],f=$(".store-list #"+b+" .pickup__info-address .address-location").text(),g=$(".store-list #"+b+" .pickup__info-address .pickup__info-city").text(),h=$(this).attr("data-cep"),c=$(this).attr("data-friendly-name"),d=$(this).html(),i=$(".secao-agendamento .data input").datepicker("getDate").toISOString().split("T")[0],j=$(".secao-agendamento .data input").datepicker("getDate").toLocaleDateString();localStorage.setItem("AG_SelectedHour",JSON.stringify({loja:a,lojaBeauty:c,horario:d,date:i,_createAt:Date.now(),enderecoLoja:f,cidadeLoja:g})),$(".pickup-install .time .time-list button").removeClass("selected"),$(e.srcElement).addClass("selected"),$(".modal-instale-na-loja > .secao-agendamento > .selected-msg b").text(c+" - "+j+" - "+d),$(".modal-instale-na-loja > .secao-agendamento > .to-select-msg").hide(),$(".modal-instale-na-loja > .secao-agendamento > .selected-msg").show(),vtexjs.checkout.calculateShipping({postalCode:h,country:"BRA",addressType:"search"}).then(a=>{Date.now()-getLastTimeWhildshieldVanePopUpWasShown()<calculatesTwelveHours()&&(s(a),$(".mz-install__button--buy").unbind("click"))})})}).fail(()=>{m(),$(".secao-agendamento > .store-list > ul").append(q())})}function m(){$(".modal-instale-na-loja .store-list .pickup-install").remove(),$(".modal-instale-na-loja .store-list .mz-install__info").remove(),$(".modal-instale-na-loja .store-list #sem-lojas").remove(),$(".secao-agendamento > .store-list > ul").html(""),$(".modal-instale-na-loja > .secao-agendamento > .selected-msg b").text(""),$(".modal-instale-na-loja > .secao-agendamento > .selected-msg").hide(),$(".modal-instale-na-loja > .secao-agendamento > .to-select-msg").show()}function n(a){return a.name.startsWith("Parabrisa")}function o(c){let a=c.store,b=c.DadosPickupPoint.address;if(!a)return null;(function(){let a=!1;if(window.location.href.includes("checkout"))vtexjs.checkout.orderForm.items.forEach(function(b){n(b)&&(a=!0)});else{let b=skuJson_0;n(b)&&(a=!0)}return a})()&&function(a){let c=17,d=11,e=Number(a.Horarios.length),b=a.Horarios[e-1].HoraInicial.split("T");(b[1].startsWith(c)||b[1].startsWith(d))&&a.Horarios.pop()}(a);let{horariosDisponiveisLoja:d,timeStampList:e}=p(a.Horarios,`${a.Nome} | ${a.Bairro}`,a.Cep,c.DadosPickupPoint.friendlyName);return`
			<div id="${b.addressId}" class="${d?"":"card-horarios-indisponiveis"} pickup pickup-install">
				<div class="pickup__info">
					<div class="pickup__info-distance">
						<svg class="pkpmodal-pickup-point-best-marker-image" width="25" height="32" viewBox="0 0 25 32" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M19.4917 22.3169L19.4918 22.3169L19.4967 22.3096C19.5843 22.1782 19.6709 22.0485 19.7564 21.9204C22.0478 18.4883 23.5645 16.2165 23.5645 12.5323C23.5645 6.16317 18.4013 1 12.0323 1C5.66317 1 0.5 6.16317 0.5 12.5323C0.5 16.5417 3.05396 20.5158 5.20313 23.2599C6.56216 24.9952 9.21424 28.1986 11.703 30.3763L12.0323 30.6644L12.3615 30.3763C14.8402 28.2075 16.7075 26.3386 19.4917 22.3169Z" fill="#2D78F6" stroke="white"></path>
							<path d="M18.6968 9.73418L14.6509 9.14642L12.8407 5.48019C12.5239 4.83994 11.4759 4.83994 11.159 5.48019L9.3498 9.14642L5.30298 9.73418C4.53711 9.84573 4.22682 10.7906 4.78365 11.3344L7.71213 14.1878L7.02126 18.2178C6.89096 18.9808 7.69338 19.5667 8.38145 19.2058L11.9999 17.3038L15.6192 19.2068C16.3017 19.5639 17.1107 18.9874 16.9794 18.2187L16.2885 14.1888L19.217 11.3353C19.7729 10.7906 19.4626 9.84573 18.6968 9.73418Z" fill="white"></path>
						</svg>
						<p>${c.Distancia.toFixed(1)} km</p>
					</div>
					<div class="pickup__info-address">
						<div class="address-title">
							<b>${c.DadosPickupPoint.friendlyName}</b>
						</div>
						<p class="address-location">
							${b.street} ${b.number},

						</p>
						<p class="pickup__info-city">${b.neighborhood} - ${b.city} - ${b.state}</p>
					</div>
				</div>
				<div class="time">
					${a?e.join("\n"):[].concat('<p class="texto-horarios-indisponiveis"> Hor\xe1rios indispon\xedveis para esta data <p>')}
				</div>
			</div>

		`}function p(a,e,f,g){let b=!1,c=[];a.length&&(c=a.map(function(a){let c=new Date(a.HoraInicial);return"Nao"!==a.Disponibilidade.Value?(b=!0,horariosDisponiveisGeral=!0,`<button data-store="${e}" data-cep="${f}" data-friendly-name="${g}" class="timestamp">
            ${c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</button>`):""}));let d=b?['<p>Hor\xe1rios:</p><div class="time-list">'].concat(c).concat("</div>"):[].concat('<p class="texto-horarios-indisponiveis"> Hor\xe1rios indispon\xedveis para esta data <p>');return{horariosDisponiveisLoja:b,timeStampList:d}}function q(){return`<div id="sem-lojas" style="
			min-height: 100px;
			display: flex;
			flex-direction: column;
			justify-content: space-evenly;">
			<p style="text-align: center;">
        N\xe3o encontramos loja para esta data, por favor selecione outra data.
			</p>
			<h4 style="text-align: center; font-weight: normal;">
        Qualquer d\xfavida,
          <span style="font-weight: bold;">
            <a onclick="$zopim.livechat.window.show()"> clique aqui </a>
          </span>
        e fale com a gente pelo chat.
			</h4>
		</div>`}function r(){return`<div id="sem-lojas-proximas" style="
			min-height: 50px;
			<h4 style="text-align: center;">
        N\xe3o encontramos lojas pr\xf3ximas \xe0 regi\xe3o informada.
			</h4>
		</div>`}function s(a){let c=[a.shippingData.availableAddresses[a.shippingData.availableAddresses.length-1],],b=a.shippingData.logisticsInfo[0];if(b){let e=b.slas.filter(a=>"pickup-in-point"===a.deliveryChannel),d=a.shippingData.logisticsInfo.map(a=>({addressId:c[0].addressId,itemIndex:a.itemIndex,selectedDeliveryChannel:"pickup-in-point",selectedSla:e[0].id}));fetch(`/api/checkout/pub/orderForm/${a.orderFormId}/attachments/shippingData`,{method:"post",body:JSON.stringify({clearAddressIfPostalCodeNotFound:!1,expectedOrderFormSections:["shippingData"],selectedAddresses:c,logisticsInfo:d})}).then(a=>a.json()).then(a=>{vtexjs.checkout.sendAttachment("shippingData",{selectedAddresses:c,logisticsInfo:d})})}}$(window).on("cep-updated",async c=>{let a=c.originalEvent.detail,b=await getDeliveriesEstimates(a.shippingData.address.postalCode,a.shippingData.logisticsInfo,a.items);k(b),l(b)})}),$(function(){let c=new Event("datepicker_carregado"),d,e=!1,a=new Date;a.setDate(a.getDate()+2);let b=new Date;async function f(i){if($("#aviso-servico-movel").hide(),$(".preview-data").hide(),i&&!e){e=!0,$(".datas-disponiveis").show(),$(".loading-dates").show(),$("#mostrar-datas-datepicker").css("height","0px");let c={Cep:i,DataInicio:a.toISOString().split("T")[0],DataFim:b.toISOString().split("T")[0],Carrinho:[],TipoDocumento:"Venda",TipoServico:"Instalacao",Qt:100};if(window.skuJson)c.Carrinho.push({CodigoProduto:+window.skuJson.name.match(/\d+$/)[0],Quantidade:1});else{let j;j=window.location.href.includes("orderPlaced")?await h():await vtexjs.checkout.getOrderForm(),c.Carrinho=j.items.filter(a=>"2000108"!==a.additionalInfo.brandId).map(a=>({CodigoProduto:+a.productRefId,Quantidade:1}))}try{let f=await g(c);d=f.Registros.map(a=>({...a,DataRoteiro:new Date(a.DataRoteiro)})),f.Registros.filter(a=>!1===a.Disponivel).length===f.Registros.length?($("#aviso-servico-movel").show().html(`
							Instala\xe7\xe3o em Casa indispon\xedvel para sua regi\xe3o. Tente alterar o CEP ou
							<a onclick="$zopim.livechat.window.show()"><b> clique aqui </b></a>
							e fale com a gente pelo chat.
						`),$(".mz-advantages__button--buy").addClass("disabled")):($("#mostrar-datas-datepicker").datepicker("setDate",a),$("#mostrar-datas-datepicker").datepicker("refresh"),$("a.ui-state-active").removeClass("ui-state-active"),$("a.ui-state-hover").removeClass("ui-state-hover"),$("#mostrar-datas-datepicker").css("height","270px"),$(".mz-advantages__button--buy").removeClass("disabled"))}catch(k){let l;$(".mz-advantages__button--buy").addClass("disabled"),l=400===k.status?JSON.parse(k.responseText).Message:"N\xe3o encontramos atendimento para este CEP. Mas procure a gente no chat para te ajudar!",$("#aviso-servico-movel").show().html(l)}finally{e=!1,$(".loading-dates").hide()}}}function g(a){return new Promise((b,c)=>{$.ajax({contentType:"application/json",crossDomain:!0,jsonp:!1,type:"POST",url:"https://api-hml.autoglass.com.br/integracao-b2c/api/web-app/agendamentos/servicos-moveis/disponibilidades",data:JSON.stringify(a),success:function(a){b(a)},error:function(a){c(a)}})})}function h(){return new Promise((a,b)=>{$.ajax({jsonp:!1,url:`/api/checkout/pub/orders/${$("#order-id").text().trim()}`,contentType:"application/json",type:"GET",success:function(b){a(b)},error:function(a){b(a)}})})}b=new Date(a.getFullYear(),a.getMonth()+2,0),$(".mz-advantages__content .cep  input").mask("99999-999").val(""),$("#mostrar-datas-datepicker").datepicker({dateFormat:"dd/mm/yy",showAnim:"slideDown",numberOfMonths:650>$(document).width()?1:2,dayNamesMin:["D","S","T","Q","Q","S","S"],monthNames:["Janeiro","Fevereiro","Mar\xe7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro",],minDate:a,maxDate:b,onSelect(a,b){localStorage.setItem("AG_SelectedDaySM",JSON.stringify({selectedDay:a,infos:b,_createAt:Date.now()})),$(".preview-data").first().fadeOut(500,()=>{$(".preview-data b").first().html(a),$(".preview-data").fadeIn(500)}),$.get("/").then()},beforeShowDay:function(a){let c=a.toDateString().includes("Sun"),e=a.toDateString().includes("Sat");if(c||e)return[!1];if(d){let b=d.find(b=>b.DataRoteiro.toLocaleDateString()===a.toLocaleDateString());if(b)return b.Disponivel?[!0]:[!1]}return[!1]}}),$("#input-cep-btn").click(function(a){f($("#cep-input").val())}),$(window).on("cep-updated",async c=>{let a=c.originalEvent.detail,d=await getDeliveriesEstimates(a.shippingData.address.postalCode,a.shippingData.logisticsInfo,a.items);(function(c){let a=c.find(a=>a.Nome.trim().toLocaleLowerCase()==="Autoglass M\xf3vel".trim().toLocaleLowerCase());a?(b=new Date(a.Data.getFullYear(),a.Data.getMonth()+2,0),$("#mostrar-datas-datepicker").datepicker("option","maxDate",b),$("#mostrar-datas-datepicker").datepicker("option","minDate",a.Data)):console.log("Falha ao setar data")})(d),f(a.shippingData.address.postalCode)}),window.dispatchEvent(c)})