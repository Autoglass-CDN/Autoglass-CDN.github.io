!function(){let e=function t(){return{buildMapFilters:u,buildURL:function e(t,a,c){let l=r(),n="";if(a.asyncSearchTerm)n+=i.ORIGIN,n+=l;else{let s=new URL(c.url);n+=i.ORIGIN,n+=s.href.replace(s.origin,"")}return n+`?${i.ASYNC.LID_FILTER}&${u(--t)}`},getCategoryTree:a,getFilters:s,search:o};async function a(){return await $.get(`${i.ORIGIN}/api/catalog_system/pub/category/tree/${i.ASYNC.TREE_LEVEL}`)}async function s(t,a,c){let l=e.buildURL(t,a,c);return await $.get(l)}function r(){return n.filter(e=>e.routeSelected).map(e=>e.routeSelected.includes("/")?e.routeSelected:`/${e.routeSelected}`).join("")}async function o(){let e=n.filter(e=>e.routeSelected).length,t=r(),a=i.ORIGIN;if(0===l.length){alert("Selecione pelo menos o produto!");return}t&&(a+=t,a+=`?${u(e-1)}`),e<1&&(a=function e(t,a){let c=t.includes("/")?t:`/${t}`;return a+c+"?PS=20&map=c,c"}(l,a)),localStorage.setItem("smartSelectHistory",JSON.stringify({type:c,params:{plate:null,url:a}})),location.href=a}function u(e){let t="";for(let a=0;a<=e;a++)t+=i.ASYNC.MAP_PARAMS[a];return t}}(),t=function e(){return{_initSelect_:function e(a){$(`.c-busca__tab-content #${a.id}`).click(e=>{$(`.c-busca__tab-content #${a.id} .smart-select__main-results input`).val(""),a.values&&(t.buildList(a.values,a.id),t.selectOptionIfButtonHasValue(a.id),0!==a.values.length&&($(`.c-busca__tab-content #${a.id} .smart-select__main-results`).slideToggle("fast").click(e=>e.stopPropagation()),$(`.c-busca__tab-content #${a.id} .smart-select__main-results input`).focus()))}),$(`.c-busca__tab-content #${a.id} .smart-select__main-results input`).on("keydown",e=>{if(("Tab"===e.key||"Enter"===e.key)&&(e.preventDefault(),$(`.c-busca__tab-content #${a.id} ul li.${i.CSS.HIGHLIGHT}`).click()),"ArrowDown"===e.key){let t=0;$(`.c-busca__tab-content #${a.id} ul li`).each((e,a)=>{a.classList.contains(i.CSS.HIGHLIGHT)&&(t+=e+2,$(a).removeClass(i.CSS.HIGHLIGHT))}),t<=$(`.c-busca__tab-content #${a.id} ul li`).length?($(`.c-busca__tab-content #${a.id} ul li:nth-child(${t})`).addClass(i.CSS.HIGHLIGHT),$(`.c-busca__tab-content #${a.id} .smart-select__main-results ul`).animate({scrollTop:$(`.c-busca__tab-content #${a.id} ul li:nth-child(${t})`)[0].offsetTop-$(`.c-busca__tab-content #${a.id} ul li:nth-child(${t})`)[0].scrollHeight-$(`.c-busca__tab-content #${a.id} ul li:nth-child(${t})`)[0].scrollHeight/2},100)):($(`.c-busca__tab-content #${a.id} ul li:nth-child(1)`).addClass(i.CSS.HIGHLIGHT),$(`.c-busca__tab-content #${a.id} .smart-select__main-results ul`).animate({scrollTop:$(`.c-busca__tab-content #${a.id} ul li:nth-child(1)`)[0].offsetTop-($(`.c-busca__tab-content #${a.id} ul li:nth-child(1)`)[0].scrollHeight+$(`.c-busca__tab-content #${a.id} ul li:nth-child(1)`)[0].scrollHeight/2)},100))}if("ArrowUp"===e.key){let c=0;$(`.c-busca__tab-content #${a.id} ul li`).each((e,t)=>{t.classList.contains(i.CSS.HIGHLIGHT)&&(c=e,$(t).removeClass(i.CSS.HIGHLIGHT))}),0!==c?($(`.c-busca__tab-content #${a.id} ul li:nth-child(${c})`).addClass(i.CSS.HIGHLIGHT),$(`.c-busca__tab-content #${a.id} .smart-select__main-results ul`).animate({scrollTop:$(`.c-busca__tab-content #${a.id} ul li:nth-child(${c})`)[0].offsetTop-($(`.c-busca__tab-content #${a.id} ul li:nth-child(${c})`)[0].scrollHeight+$(`.c-busca__tab-content #${a.id} ul li:nth-child(${c})`)[0].scrollHeight/2)},100)):($(`.c-busca__tab-content #${a.id} ul li:nth-child(${$(`.c-busca__tab-content #${a.id} ul li`).length})`).addClass(i.CSS.HIGHLIGHT),$(`.c-busca__tab-content #${a.id} .smart-select__main-results ul`).animate({scrollTop:$(`.c-busca__tab-content #${a.id} ul li:nth-child(${$(`.c-busca__tab-content #${a.id} ul li`).length})`)[0].offsetTop-($(`.c-busca__tab-content #${a.id} ul li:nth-child(${$(`.c-busca__tab-content #${a.id} ul li`).length})`)[0].scrollHeight+$(`.c-busca__tab-content #${a.id} ul li:nth-child(${$(`.c-busca__tab-content #${a.id} ul li`).length})`)[0].scrollHeight/2)},100))}}).on("keyup",e=>{console.log("Filtrando"),["Tab","ArrowDown","ArrowUp","Enter"].find(t=>t===e.key)||t.filterResults(e,a)}),$(document).on("click",e=>{var t=$(`.c-busca__tab-content #${a.id}`);$(e.target).closest(t).length||$(`.c-busca__tab-content #${a.id} .smart-select__main-results`).slideUp("fast")})},buildList:l,selectOptionIfButtonHasValue:function e(t){$(`.c-busca__tab-content > .${t} ul li`).each((e,a)=>{a.innerHTML===$(`.c-busca__tab-content > .${t} div > span`).html()&&$(a).addClass(i.CSS.SELECTED)})},filterResults:function e(t,a){if(t.target.value){let c=a.values.filter(e=>r(e.name.toUpperCase()).includes(r(t.target.value.toUpperCase())));l(c,a.id)}else l(a.values,a.id)},resetResults:s,virtualizedDOM:function e(t,a){let c=document.createElement("div");return c.innerHTML=t,[...c.querySelectorAll(`${a} > li > a`)].map(e=>({id:e.href,name:e.innerHTML.replace(/\s\(\d+\)/,""),pathname:e.pathname,search:e.search}))},createNavigation:function e(t,a){let c=n.findIndex(e=>e.id===t),l=n[c],r=n[c+1];$(`.c-busca__tab-content  #${l.id} > div > span`).html(a),$(`.c-busca__tab-content  #${l.id} > div > .${i.CSS.ARROW_DOWN}`).hide(),$(`.c-busca__tab-content  #${l.id} > div > .${i.CSS.CLOSE}`).show().on("click",()=>s(c)),r?($(`.c-busca__tab-content #${r.id}`).removeClass(i.CSS.EMPTY),i.CANT_OPEN||$(`.c-busca__tab-content #${r.id}`).click()):i.CANT_OPEN||$(`.c-busca__tab-content  #${l.id}`).click().focus()}};function l(e,t){let l="";e?(e.forEach(e=>l+=`<li role="treeitem" id="${e.id}">${e.name}</li>`),$(`.c-busca__tab-content  #${t} ul`).html(l),$(`.c-busca__tab-content  #${t} ul li`).hover(e=>{$(`.c-busca__tab-content  #${t} ul li`).removeClass(i.CSS.HIGHLIGHT),$(e.target).addClass(i.CSS.HIGHLIGHT)}).click(e=>{switch(c){case"#busca-peca":a.addClick(e,t);break;case"#busca-placa":d(e,t)}}),$(`.c-busca__tab-content  #${t} ul li`).first().addClass(i.CSS.HIGHLIGHT)):$(`.c-busca__tab-content  #${t} ul`).html('<li style="background: white; color:#707070; cursor: default">Nenhum resultado encontrado.</li>')}function s(e){for(let t=e;t<=n.length-1;t++){let a=n[t],c=n[t+1];$(`.c-busca__tab-content  #${a.id} > div > span`).html(a.title),a.routeSelected="",c&&c.canBeClear&&($(`.c-busca__tab-content #${c.id}`).addClass(i.CSS.EMPTY),c.values=[],c.routeSelected=""),$(`.c-busca__tab-content  #${a.id} > div > .${i.CSS.ARROW_DOWN}`).show(),$(`.c-busca__tab-content  #${a.id} > div > .${i.CSS.CLOSE}`).hide()}}function r(e){return[{char:"A",base:/[\300-\306]/g},{char:"a",base:/[\340-\346]/g},{char:"E",base:/[\310-\313]/g},{char:"e",base:/[\350-\353]/g},{char:"I",base:/[\314-\317]/g},{char:"i",base:/[\354-\357]/g},{char:"O",base:/[\322-\330]/g},{char:"o",base:/[\362-\370]/g},{char:"U",base:/[\331-\334]/g},{char:"u",base:/[\371-\374]/g},{char:"N",base:/[\321]/g},{char:"n",base:/[\361]/g},{char:"C",base:/[\307]/g},{char:"c",base:/[\347]/g},].forEach(function(t){e=e.replace(t.base,t.char)}),e}}(),a=function c(){return{addClick:s,checkRouterParams:r};async function s(a,c){let i=n.findIndex(e=>e.id===c),s=n[i],r=n[i+1],o=s.values.find(e=>e.id==a.target.id),u=new b;if(u.mostarSpinner(),t.resetResults(i),0!==i?s.routeSelected=o.url?o.url.replace(new URL(o.url).origin,""):o.name:l=o.url?o.url.replace(new URL(o.url).origin,""):o.name,r){if(o&&s.isAsyncSearch){let d=await e.getFilters(i,s,o),h=t.virtualizedDOM(d,r.asyncSearchTerm);i+1===n.length-1?h.sort((e,t)=>t.name.localeCompare(e.name)):h.sort((e,t)=>e.name.localeCompare(t.name)),r.values=h}else r.values=o.children.sort((e,t)=>e.name.localeCompare(t.name));t.buildList(r.values,r.id)}t.createNavigation(s.id,a.target.innerHTML),u.ocultarSpinner()}async function r(){let{pathname:e,search:t}=location;if(t&&t.includes(i.ASYNC.MAP_PARAMS[0])||t.includes("?PS=20&map=c,c")){i.CANT_OPEN=!0;let c=decodeURI(e).split("/").filter(e=>e),{input:l,...s}=c.slice(0,3).join("/").match(/(\w+\/\w+)/),r=[s[0],l,...c.slice(3,c.length),];t.match(/\?PS=20&map=c,c$/)&&(r=[s[0]]);for(let o=0;o<r.length;o++){let u=n[o],d=u.values.find(e=>e.url?e.url.includes(r[o]):e.name.includes(r[o]));await a.addClick({target:{id:d.id,innerHTML:d.name}},u.id)}}i.CANT_OPEN=!1}}(),c="#busca-peca",l="",i={ASYNC:{MAP_PARAMS:["PS=20&map=c,c,c",",specificationFilter_36",",specificationFilter_50",",specificationFilter_48"],TREE_LEVEL:2,LID_FILTER:"lid=bf120500-baab-4185-8b70-cc630f7d1c70"},CSS:{HIGHLIGHT:"highlight",EMPTY:"empty",ARROW_DOWN:"fa-caret-down",CLOSE:"fa-close",SELECTED:"selected"},CANT_OPEN:!1,ORIGIN:"https://www.autoglassonline.com.br"},n=[{title:"Produto",id:"produtos-select",values:[],routeSelected:"",isAsyncSearch:!1,asyncSearchTerm:"",canBeClear:!1},{title:"Pe\xe7a",id:"pecas-select",values:[],routeSelected:"",isAsyncSearch:!0,asyncSearchTerm:"",canBeClear:!0},{title:"Montadora",id:"montadora-select",values:[],routeSelected:"",isAsyncSearch:!0,asyncSearchTerm:".Compatibilidade.Montadora",canBeClear:!0},{title:"Ve\xedculo",id:"veiculo-select",values:[],routeSelected:"",isAsyncSearch:!0,asyncSearchTerm:".Ve\xedculo",canBeClear:!0},{title:"Ano",id:"ano-select",values:[],routeSelected:"",isAsyncSearch:!0,asyncSearchTerm:".Ano",canBeClear:!0},];async function s(){var a;let c=await e.getCategoryTree(),l=[];c.filter(e=>e.hasChildren).forEach(e=>{l.push(...e.children)}),a=l,u[0].values=a,t.buildList(u[0].values,u[0].id),t._initSelect_(u[0]),function e(){let{pathname:t,search:a}=location,c=JSON.parse(localStorage.getItem("smartSelectHistory")),l=c&&"#busca-placa"==c.type;if(a&&a.includes("?PS=24&map=")){if(a.includes("c,c,")){let i=decodeURI(t).split("/").filter(e=>e),n=i.slice(0,2).join("/"),s=u[0],r=s.values.find(e=>e.url?e.url.includes(n):e.name.includes(n));d({target:{id:r.id,innerHTML:r.name}},s.id)}l&&(document.querySelector("a[href='#busca-placa']").click(),document.querySelector("#placa-input").value=c.params.plate)}if(l&&c.params.url){if(a||(a=""),t||(t=""),!a.includes("?PS=24&map=")&&!t.includes("buscavazia")){localStorage.removeItem("smartSelectHistory");return}let[o,h]=c.params.url.split("?"),b=o.split("/").filter(e=>e),p=h.includes("c,c,")?b.slice(2,b.length):b;3===p.length&&p.splice(1,1);let m=p.reverse().join(" "),f=$(".resultado-busca-termo");f.length&&(f.addClass("has-value"),f.find(".value").text(m));let S=$("#busca-ft span:empty");S.length&&S.text(m+".")}}(),document.querySelector("#form-busca-placa").addEventListener("submit",e=>{e.preventDefault();let[t,a]=function e(){let t=u[0];if(t.routeSelected.length){let a=t.routeSelected;if(["/lampadas","/filtros","/higienizadores"].some(e=>a.includes(e)))return[!0,`${a}?PS=20&map=c,c`];if(a.includes("/borrachas-e-outros/borracha"))return[!0,"/borrachas-e-outros/borracha/borracha-universal-parabrisa?PS=20&map=c,c,c",]}return[!1,""]}();if(t){let c=new b;c.mostarSpinner(),location.href=a}else{let l=document.querySelector("#placa-input").value;0===l.length?alert("Voc\xea deve inserir a placa do seu ve\xedculo!"):l.trim().match(/^[A-Z]{3}[\-_]?[0-9][0-9A-Z][0-9]{2}$/i)?h(l):alert("Sua placa n\xe3o segue um padr\xe3o v\xe1lido!")}}),await r(l)}async function r(c){n[0].values=c,console.log(n),await a.checkRouterParams(),t.buildList(n[0].values,n[0].id),n.forEach(t._initSelect_),$("#form-busca-peca").submit(t=>{t.preventDefault(),e.search()})}s(),window.onload=()=>{if(window.matchMedia("(max-width: 1100px)").matches){var e=$(".system-error-qd-v1");(e.length||(e=$(".search-qd-v1-result")).length)&&(pixelsToScroll=(aimElementTopOffset=e.offset().top)-(offsets=$("header.nav").height()+$("div.topo").height()),$("html, body").animate({scrollTop:pixelsToScroll},"slow"))}};let o=document.querySelectorAll(".c-busca__tabs li");o.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),o.forEach(e=>e.classList.remove("is-active")),e.classList.add("is-active"),c=e.querySelector("a").attributes.href.nodeValue;document.querySelectorAll(".c-busca__tab-content").forEach(e=>e.classList.remove("is-active"));document.querySelector(e.querySelector("a").hash).classList.add("is-active")})});let u=[{title:"Produto",id:"categoria-select",values:[],routeSelected:"",isAsyncSearch:!1,asyncSearchTerm:"",canBeClear:!1},];function d(e,t){let a=u[0],c=a.values.find(t=>t.id==e.target.id);a.routeSelected=c.url?c.url.replace(new URL(c.url).origin,""):"/"+c.name.toLowerCase(),$(`.c-busca__tab-content  #${a.id} > div > span`).html(e.target.innerHTML),$(`.c-busca__tab-content  #${a.id} > div > .${i.CSS.ARROW_DOWN}`).hide(),$(`.c-busca__tab-content  #${a.id} > div > .${i.CSS.CLOSE}`).show().on("click",()=>{$(`.c-busca__tab-content  #${a.id} > div > span`).html(a.title),a.routeSelected="",$(`.c-busca__tab-content  #${a.id} > div > .${i.CSS.ARROW_DOWN}`).show(),$(`.c-busca__tab-content  #${a.id} > div > .${i.CSS.CLOSE}`).hide()}),$(".c-busca__tab-content .c-busca__input #placa-input").click().focus()}async function h(e){var t,a,l;let n=u[0],s={MONTADORA:36,VEICULO:50,ANO:48},r=new b,o=(t=e,t.trim().replace(/[\W_]+/g,"").toUpperCase());try{r.mostarSpinner();let d=await fetch(`https://crawler-keplaca.herokuapp.com/placa/${o}`),[h,p,m]=await d.json();if(null===h&&null===p&&null===m)throw new G(o);console.table({Montadora:h,Modelo:p,Ano:m});let f=await fetch(`${i.ORIGIN}/api/catalog_system/pub/specification/fieldValue/${s.MONTADORA}`),S=await f.json(),g=(a=h,RegExp(a.split(" ").join("|"),"gi")),v=S.filter(e=>g.test(e.Value));console.log(v);let C=await fetch(`${i.ORIGIN}/api/catalog_system/pub/specification/fieldValue/${s.VEICULO}`),y=await C.json(),H=function e(t,a){let c=t.split(" ").filter(e=>RegExp(/[^\W_]+/,"gi").test(e));"VOLKSWAGEN"===c[0].toUpperCase()&&c.push("VW"),"GM"===c[0].toUpperCase()&&c.push("CHEV");let l=a.replace(RegExp(c.join("|"),"gi"),"").trim().split(" "),i=["NOVA","NOVO"].some(e=>l.find(t=>t.toUpperCase()===e))?l[1]:l[0];"PAJERO"===l[0].toUpperCase()&&l[1]&&(i=l[0]+" "+l[1]);let n=i.replace(/[\W]+/gi,""),s=`(${c.join("|")})`,r=i===n?i:`(${i}|${n})`,o="STRADA"===n.toUpperCase(),u=`${o?"^":""}${r}$|${s} ${r}$`;return console.log(u),RegExp(u,"gi")}(h,p),A=y.filter(e=>H.test(e.Value));console.log(A);let T=await fetch(`${i.ORIGIN}/api/catalog_system/pub/specification/fieldValue/${s.ANO}`),I=await T.json(),L=(l=m,RegExp(l.trim(),"gi")),w=I.filter(e=>L.test(e.Value));console.log(w);let O="",E="?PS=24&map=";if(!w.length&&!v.length&&!A.length)throw new G(o);if(n.routeSelected.length&&(O+=n.routeSelected,E+="c,c,"),w.length&&(O+=`/${w[0].Value}`,E+=`specificationFilter_${s.ANO},`),v.length){let _=v[0].Value;_="Gm"===_?"Chevrolet":_,O+=`/${_}`,E+=`specificationFilter_${s.MONTADORA},`}A.length&&(O+=`/${A[0].Value}`,E+=`specificationFilter_${s.VEICULO}`),O+=E,localStorage.setItem("smartSelectHistory",JSON.stringify({type:c,params:{plate:o,url:O}})),console.log(O)}catch(N){N instanceof G?alert("Desculpe, n\xe3o conseguimos encontrar o seu ve\xedculo, favor utilizar a busca por pe\xe7a ou digitar seu carro e produto na busca livre no topo do site."):(alert("Perd\xe3o pelo inconveniente! O servi\xe7o de busca por placa est\xe1 fora do ar no momento. Favor utilizar a busca por pe\xe7a!"),console.error(N)),r.ocultarSpinner(),document.querySelector("a[href='#busca-peca']").click()}function G(e){this.value=e,this.message=" n\xe3o retornou resultados.",this.toString=function(){return this.value+this.message}}}class b{constructor(){let e=document.querySelectorAll(".smart-select__main-results"),t=document.querySelector(".c-busca .smart-select__modal");this.elementos=[...e,t]}mostarSpinner(){this.elementos.forEach(e=>e.classList.add("loader-modal--show"))}ocultarSpinner(){this.elementos.forEach(e=>e.classList.remove("loader-modal--show"))}}}();